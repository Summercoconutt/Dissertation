# Visual System Flow Diagram

## 🔄 Complete Data Flow Architecture

```
                    DAO GOVERNANCE SIMULATION SYSTEM
                         Complete Data Flow
                              
┌─────────────────────────────────────────────────────────────────────────────┐
│                            INPUT LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📄 merged_snapshot.csv                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ voter_address  │ vote_choice │ timestamp    │ token_amount           │   │
│  │ 0xABC123...    │ for         │ 2024-01-15   │ 1000.0                 │   │
│  │ 0xDEF456...    │ against     │ 2024-01-16   │ 500.5                  │   │
│  │ 0xGHI789...    │ abstain     │ 2024-01-17   │ 250.0                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DATA PROCESSING                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📊 data_loader.py                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ load_snapshot_data()                                                │   │
│  │  ├─ Parse timestamps                                                 │   │
│  │  ├─ Clean data                                                       │   │
│  │  └─ Return structured DataFrame                                      │   │
│  │                                                                     │   │
│  │ get_user_profiles()                                                 │   │
│  │  ├─ Aggregate by voter_address                                      │   │
│  │  ├─ Calculate vote_count & total_tokens                             │   │
│  │  └─ Create user statistics                                          │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AGENT TRAINING LAYER                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  🤖 agent_base.py - UserBehaviorAgent                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                     │   │
│  │  INPUT: UserVoteHistory                   OUTPUT: VotePrediction    │   │
│  │  ┌─────────────────────┐                ┌─────────────────────────┐ │   │
│  │  │ voter_address: str  │                │ predicted_vote: int     │ │   │
│  │  │ proposal_ids: []    │ ──────────────▶│ confidence: float       │ │   │
│  │  │ vote_labels: [0,1,0]│                └─────────────────────────┘ │   │
│  │  └─────────────────────┘                                          │   │
│  │                                                                     │   │
│  │  TRAINING PIPELINE:                                                 │   │
│  │  1. prepare_training_data(df) ─────────────────┐                   │   │
│  │     │                                          │                   │   │
│  │     ├─ Map votes to labels [for→0, against→1]  │                   │   │
│  │     ├─ Create sliding windows [0,1,0] → [1]    │                   │   │
│  │     └─ Generate X_features, y_targets          │                   │   │
│  │                                          │                   │   │
│  │  2. train() ──────────────────────────────────┘                   │   │
│  │     │                                                              │   │
│  │     ├─ Split 80/20 train/test                                      │   │
│  │     ├─ Train RandomForestClassifier                                │   │
│  │     └─ Print classification_report                                 │   │
│  │                                                                     │   │
│  │  3. predict(UserVoteHistory) ──────────────────────────────────────┤   │
│  │     │                                                              │   │
│  │     ├─ Extract vote_labels window                                  │   │
│  │     ├─ model.predict_proba()                                       │   │
│  │     └─ Return prediction + confidence                              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      VOTER POOL PREPARATION                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  🏊 Create Voter Pool DataFrame                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ voter_address │ token_amount │ reputation │ history                 │   │
│  │ 0xABC123...   │ 1000.0       │ 25         │ [0,1,0,1,0]             │   │
│  │ 0xDEF456...   │ 500.5        │ 12         │ [1,1,0,0,1]             │   │
│  │ 0xGHI789...   │ 250.0        │ 8          │ [0,0,0,1,2]             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                       MECHANISM SIMULATION                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ⚙️ mechanism_simulation.py                                                │
│                                                                             │
│  FOR EACH MECHANISM: ["token", "quadratic", "reputation", "hybrid"]       │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                     │   │
│  │  simulate_proposal() ── runs for each round (100x default)         │   │
│  │  │                                                                 │   │
│  │  ├─ 1. Sample voters (participation_rate × voter_pool)             │   │
│  │  │   ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │   │ Random sample: 30% of voters                           │   │   │
│  │  │   │ Selected: [0xABC, 0xDEF, 0xGHI]                        │   │   │
│  │  │   └─────────────────────────────────────────────────────────┘   │   │
│  │  │                                                                 │   │
│  │  ├─ 2. For each selected voter:                                    │   │
│  │  │   ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │   │ Extract history → UserVoteHistory                      │   │   │
│  │  │   │ Agent.predict() → VotePrediction                       │   │   │
│  │  │   │ Get tokens & reputation                                │   │   │
│  │  │   └─────────────────────────────────────────────────────────┘   │   │
│  │  │                                                                 │   │
│  │  ├─ 3. Apply voting mechanism:                                     │   │
│  │  │   ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │   │ TOKEN:     power = tokens                              │   │   │
│  │  │   │ QUADRATIC: power = √(tokens)                           │   │   │
│  │  │   │ REPUTATION:power = log(1 + reputation)                 │   │   │
│  │  │   │ HYBRID:    power = α×√(tokens) + (1-α)×log(1+rep)      │   │   │
│  │  │   └─────────────────────────────────────────────────────────┘   │   │
│  │  │                                                                 │   │
│  │  ├─ 4. Calculate proposal outcome:                                 │   │
│  │  │   ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │   │ for_power = Σ(power where vote=0)                      │   │   │
│  │  │   │ against_power = Σ(power where vote=1)                  │   │   │
│  │  │   │ passed = (for_power > against_power)                   │   │   │
│  │  │   └─────────────────────────────────────────────────────────┘   │   │
│  │  │                                                                 │   │
│  │  └─ 5. Calculate metrics → {gini, hhi, participation, utility}     │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         EVALUATION LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📏 evaluation.py - Metrics Calculation                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                     │   │
│  │  FAIRNESS METRICS:                                                  │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │ calculate_gini(voting_power) → Inequality measure          │   │   │
│  │  │ calculate_hhi(voting_power)  → Concentration measure       │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                     │   │
│  │  EFFICIENCY METRICS:                                                │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │ calculate_participation_rate() → Engagement measure        │   │   │
│  │  │ calculate_pass_rate() → Decision throughput               │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                     │   │
│  │  COMBINED UTILITY:                                                  │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │ calculate_utility(gini, participation)                     │   │   │
│  │  │ Formula: U = α × participation - β × gini                  │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          RESULTS AGGREGATION                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📊 simulator.py - run_simulation()                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                     │   │
│  │  FOR EACH MECHANISM:                                                │   │
│  │  │                                                                 │   │
│  │  ├─ Run 100 proposal simulations                                   │   │
│  │  ├─ Collect results from each round                                │   │
│  │  ├─ Calculate averages across all rounds                           │   │
│  │  └─ Create summary DataFrame                                       │   │
│  │                                                                     │   │
│  │  FINAL OUTPUT:                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │ mechanism  │ gini   │ hhi    │ participation │ utility       │   │   │
│  │  │ token      │ 0.721  │ 0.234  │ 0.300         │ -0.421        │   │   │
│  │  │ quadratic  │ 0.456  │ 0.167  │ 0.300         │ -0.156        │   │   │
│  │  │ reputation │ 0.389  │ 0.145  │ 0.300         │ -0.089        │   │   │
│  │  │ hybrid     │ 0.423  │ 0.156  │ 0.300         │ -0.123        │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         VISUALIZATION LAYER                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📈 plots.py                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                     │   │
│  │  plot_bar_comparison():                                             │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │        Governance Metrics Comparison                       │   │   │
│  │  │   0.8 ┤                                                    │   │   │
│  │  │   0.6 ┤  ██                                                │   │   │
│  │  │   0.4 ┤  ██  ██  ██                                        │   │   │
│  │  │   0.2 ┤  ██  ██  ██  ██                                    │   │   │
│  │  │   0.0 └──┴───┴───┴───┴─────────▶                          │   │   │
│  │  │      Token Quad Rep Hybrid    Mechanism                   │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                     │   │
│  │  plot_radar_chart():                                               │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │           Mechanism Performance Radar                      │   │   │
│  │  │                     Participation                          │   │   │
│  │  │                          △                                 │   │   │
│  │  │                         ╱ ╲                                │   │   │
│  │  │               Utility  ╱   ╲  Pass Rate                    │   │   │
│  │  │                      ◄─────►                               │   │   │
│  │  │                     ╱       ╲                              │   │   │
│  │  │                    ╱         ╲                             │   │   │
│  │  │                   ▽───────────▽                            │   │   │
│  │  │                  Gini        HHI                           │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                     │   │
│  │  OUTPUT FILES:                                                      │   │
│  │  ├─ bar_plot_metrics.png                                           │   │
│  │  └─ radar_plot_metrics.png                                         │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 Component Interaction Flow

```
   [Data] ──┐
            ├──▶ [Agent Training] ──┐
   [Config]─┘                       │
                                    ▼
                            [Trained Agent] ──┐
                                             │
   [Voter Pool] ─────────────────────────────┼──▶ [Simulation Engine]
                                             │           │
   [Mechanism Choice] ───────────────────────┘           │
                                                         ▼
                                                 [Proposal Results]
                                                         │
                                                         ▼
                                                   [Metrics Calc]
                                                         │
                                                         ▼
                                                  [Aggregated Results]
                                                         │
                                                         ▼
                                                   [Visualizations]
```

## 🎛️ Extension Points Map

```
NEW MECHANISMS ──▶ mechanism_simulation.py ──▶ simulate_proposal()
NEW AGENTS ──────▶ agent_base.py ──────────────▶ UserBehaviorAgent
NEW METRICS ─────▶ evaluation.py ─────────────▶ calculate_*()
NEW DATA ────────▶ data_loader.py ────────────▶ load_*_data()
NEW PLOTS ───────▶ plots.py ──────────────────▶ plot_*()
NEW SIMULATIONS ─▶ simulator.py ─────────────▶ run_simulation()
```